{% extends "base.html" %}

{% block title %}Register - Scroll Press{% endblock %}

{% block extra_head %}
{% if turnstile_site_key %}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" async defer></script>
{% endif %}
{% endblock %}

{% block content %}
<div class="auth-container">
  <div class="auth-header">
    <h1>Create Your Account</h1>
    <p>Join the academic community on Press</p>
  </div>

  {% include "auth/partials/register_form.html" %}

  <div class="auth-links">
    <p>Already have an account? <a href="/login">Sign in here</a></p>
  </div>

  <div class="back-link">
    <a href="/">‚Üê Back to Press</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
{% if turnstile_site_key %}
<script>
  function renderTurnstile() {
    var el = document.getElementById('turnstile-container');
    if (!el || !el.dataset.turnstileSitekey) return;
    if (el.querySelector('iframe')) return;
    if (typeof turnstile === 'undefined') {
      setTimeout(renderTurnstile, 300);
      return;
    }
    turnstile.render(el, {
      sitekey: el.dataset.turnstileSitekey,
      theme: 'auto',
      callback: function(token) {
        var input = document.getElementById('turnstile-token');
        if (input) input.value = token;
      }
    });
  }
  document.addEventListener('DOMContentLoaded', renderTurnstile);
  document.addEventListener('htmx:afterSettle', renderTurnstile);
</script>
{% endif %}
{% endblock %}
